<div class="flex font-sans h-full bg-[#fafaf9] dark:bg-slate-950 transition-colors duration-300">

  <!-- MAIN CONTENT -->
  <div class="flex-1 flex flex-col h-full min-w-0 relative">



    <!-- Messages Area -->
    <div class="flex-1 overflow-y-auto scrollbar-chat" #messageContainer>

      <!-- Welcome Screen -->
      <div *ngIf="!activeChatId" class="flex flex-col items-center justify-center h-full px-6 text-center py-16">

        <div class="mb-8 relative">
          <div class="w-14 h-14 rounded-2xl flex items-center justify-center relative overflow-hidden
                      bg-black/4 border border-black/8
                      dark:bg-white/5 dark:border-white/10">
            <div
              class="absolute inset-0 bg-gradient-to-br from-[#c97b4b]/20 to-transparent dark:from-[#e07b4b]/30 opacity-40">
            </div>
            <svg class="w-6 h-6 relative z-10 text-[#c97b4b] dark:text-[#e07b4b]" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
              <circle cx="12" cy="12" r="10" opacity="0.3" />
              <path d="M8 12h8M12 8v8" />
            </svg>
          </div>
        </div>

        <h1 class="text-[2rem] font-semibold tracking-tight mb-2 leading-none text-[#1a1a1a] dark:text-white">
          How can I help?
        </h1>
        <p class="text-sm leading-relaxed max-w-xs mb-10 text-black/40 dark:text-white/40">
          Ask anything â€” I'll do my best to help.
        </p>

        <div class="flex flex-wrap gap-2 justify-center max-w-lg">
          <button *ngFor="let s of suggestions"
            class="px-4 py-2 text-[13px] rounded-xl border transition-all duration-150
                   bg-white border-black/8 text-black/55 shadow-sm hover:border-[#c97b4b]/40 hover:bg-[#fdf6f1] hover:text-black/80
                   dark:bg-white/[0.04] dark:border-white/[0.08] dark:text-white/60 dark:hover:bg-white/[0.08] dark:hover:border-[#e07b4b]/30 dark:hover:text-white/90"
            (click)="useSuggestion(s)">
            {{ s }}
          </button>
        </div>
      </div>

      <!-- Chat Messages -->
      <div *ngIf="activeChatId" class="w-full max-w-3xl  mx-auto px-4 md:px-6 py-8 space-y-6">

        <div *ngFor="let msg of currentMessages" class="flex gap-3 animate-fade-in"
          [ngClass]="{'justify-end': msg.role === 'user'}">

          <!-- Assistant Avatar -->
          <div *ngIf="msg.role === 'assistant'" class="shrink-0 mt-0.5">
            <div class="w-7 h-7 rounded-lg flex items-center justify-center border
                        bg-[#c97b4b]/8 border-[#c97b4b]/15
                        dark:bg-[#e07b4b]/10 dark:border-[#e07b4b]/20">
              <svg width="12" height="12" viewBox="0 0 22 22" fill="none" class="text-[#c97b4b] dark:text-[#e07b4b]"
                stroke="currentColor" stroke-width="1.5">
                <circle cx="11" cy="11" r="9" opacity="0.4" />
                <circle cx="11" cy="11" r="3" fill="currentColor" opacity="0.7" stroke="none" />
              </svg>
            </div>
          </div>

          <!-- Assistant Message -->
          <div *ngIf="msg.role === 'assistant'" class="flex-1 min-w-0 text-[14px] leading-[1.75] max-w-2xl prose-aria
                   text-[#1a1a1a] dark:text-white/85" [innerHTML]="renderMarkdown(msg.content)">
          </div>

          <!-- User Message -->
          <div *ngIf="msg.role === 'user'" class="max-w-xs md:max-w-md px-4 py-2.5 rounded-2xl rounded-tr-md text-[14px] leading-relaxed
                   bg-white border border-black/[0.07] text-[#1a1a1a] shadow-sm
                   dark:bg-white/[0.07] dark:border-white/[0.09] dark:text-white/90">
            {{ msg.content }}
          </div>
        </div>

        <!-- Typing Indicator -->
        <div *ngIf="isGenerating" class="flex gap-3 animate-fade-in">
          <div class="shrink-0 mt-0.5">
            <div class="w-7 h-7 rounded-lg flex items-center justify-center border
                        bg-[#c97b4b]/8 border-[#c97b4b]/15
                        dark:bg-[#e07b4b]/10 dark:border-[#e07b4b]/20">
              <svg width="12" height="12" viewBox="0 0 22 22" fill="none" class="text-[#c97b4b] dark:text-[#e07b4b]"
                stroke="currentColor" stroke-width="1.5">
                <circle cx="11" cy="11" r="9" opacity="0.4" />
                <circle cx="11" cy="11" r="3" fill="currentColor" opacity="0.7" stroke="none" />
              </svg>
            </div>
          </div>
          <div class="flex items-center gap-1.5 py-2 px-3.5 rounded-xl border
                      bg-white border-black/[0.07] shadow-sm
                      dark:bg-white/[0.04] dark:border-white/[0.07]">
            <span class="w-1.5 h-1.5 rounded-full animate-bounce bg-[#c97b4b]/60 dark:bg-[#e07b4b]/60"
              style="animation-delay:0ms"></span>
            <span class="w-1.5 h-1.5 rounded-full animate-bounce bg-[#c97b4b]/60 dark:bg-[#e07b4b]/60"
              style="animation-delay:160ms"></span>
            <span class="w-1.5 h-1.5 rounded-full animate-bounce bg-[#c97b4b]/60 dark:bg-[#e07b4b]/60"
              style="animation-delay:320ms"></span>
          </div>
        </div>

      </div>
    </div>

    <!-- Input Area -->
    <div class="flex-shrink-0 px-4 md:px-6 py-4
            bg-[#fafaf9] dark:bg-slate-950 transition-colors duration-300">

  <div class="max-w-3xl mx-auto">

    <!-- Outer pill container -->
    <div class="rounded-3xl border transition-all duration-200
                bg-white border-black/[0.09] shadow-sm
                dark:bg-[#1e1f20] dark:border-white/[0.09]
                focus-within:shadow-md">

      <!-- Textarea -->
      <div class="px-5 pt-4 pb-2">
        <textarea
          [(ngModel)]="userInput"
          rows="1"
          class="w-full resize-none bg-transparent text-[15px] leading-relaxed focus:outline-none border-0 focus:ring-0 min-h-[28px] max-h-[200px]
                 text-[#1a1a1a] placeholder-black/35
                 dark:text-white dark:placeholder-white/30"
          placeholder="How can I help you today?"
          (keydown.enter)="handleEnter($event)"
          (input)="autoResize($event)">
        </textarea>
      </div>

      <!-- Bottom toolbar -->
      <div class="flex items-center justify-between px-3 pb-3 pt-1 gap-2">

        <!-- Left side: model + action buttons -->
        <div class="flex items-center gap-1">

          <!-- Attach -->
          <button class="flex items-center justify-center w-8 h-8 rounded-full transition-all duration-150
                         text-black/40 hover:text-black/70 hover:bg-black/[0.06]
                         dark:text-white/40 dark:hover:text-white/80 dark:hover:bg-white/[0.07]"
                  title="Attach files">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
            </svg>
          </button>

          <!-- Search toggle -->
          <button class="flex items-center gap-1.5 h-8 px-3 rounded-full text-[12.5px] font-medium transition-all duration-150
                         text-black/50 hover:text-black/80 hover:bg-black/[0.06]
                         dark:text-white/40 dark:hover:text-white/80 dark:hover:bg-white/[0.07]">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
            Search
          </button>

          <!-- Research toggle -->
          <button class="flex items-center gap-1.5 h-8 px-3 rounded-full text-[12.5px] font-medium transition-all duration-150
                         text-black/50 hover:text-black/80 hover:bg-black/[0.06]
                         dark:text-white/40 dark:hover:text-white/80 dark:hover:bg-white/[0.07]">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
            Research
          </button>

        </div>

        <!-- Right side: send button -->
        <button
          class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-150
                 disabled:cursor-not-allowed
                 enabled:bg-[#1a1a1a] enabled:hover:bg-black/80
                 dark:enabled:bg-white dark:enabled:hover:bg-white/90
                 disabled:bg-black/8
                 dark:disabled:bg-white/10"
          [disabled]="!userInput.trim() || isGenerating"
          (click)="sendMessage()">
          <!-- Arrow up icon -->
          <svg class="enabled:text-white dark:enabled:text-black disabled:text-black/25 dark:disabled:text-white/25"
               [ngClass]="userInput.trim() && !isGenerating
                 ? 'text-white dark:text-[#1a1a1a]'
                 : 'text-black/25 dark:text-white/25'"
               width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 19V5M5 12l7-7 7 7"/>
          </svg>
        </button>

      </div>
    </div>

    <!-- Footer note -->
    <p class="text-center text-[11px] mt-2.5 text-black/25 dark:text-white/20">
      AI can make mistakes. Consider checking important information.
    </p>

  </div>
</div>

  </div>
</div>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(6px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.25s ease-out;
  }

  .scrollbar-chat::-webkit-scrollbar {
    width: 5px;
  }

  .scrollbar-chat::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollbar-chat::-webkit-scrollbar-thumb {
    background: rgba(128, 128, 128, 0.18);
    border-radius: 99px;
  }

  .scrollbar-chat::-webkit-scrollbar-thumb:hover {
    background: rgba(128, 128, 128, 0.3);
  }

  .prose-aria p {
    margin: 0 0 0.75em;
  }

  .prose-aria p:last-child {
    margin-bottom: 0;
  }

  .prose-aria code {
    font-size: 0.8em;
    padding: 0.15em 0.4em;
    border-radius: 5px;
  }

  .prose-aria pre {
    padding: 1em;
    border-radius: 10px;
    overflow-x: auto;
    margin: 0.75em 0;
    font-size: 0.82em;
  }
</style>