<!-- finance-header.component.html -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
  <div>
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
      <span class="material-symbols-outlined text-accent text-3xl"
            style="font-variation-settings: 'FILL' 1;">
        account_balance_wallet
      </span>
      Finance Tracker
    </h1>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
      Track, categorize and manage your monthly spending
    </p>
  </div>

  <div class="flex items-center gap-2">
    <button (click)="openBudgetSettings()"
            class="px-4 py-2 rounded-xl text-sm font-medium border border-gray-200 dark:border-slate-700
                   text-gray-700 dark:text-gray-300 hover:border-accent hover:text-accent
                   transition-all flex items-center gap-2">
      <span class="material-symbols-outlined text-lg">settings</span>
      Budget
    </button>
    <button (click)="openAddForm()"
            class="px-4 py-2 rounded-xl text-sm font-medium text-white btn-accent shadow-lg
                   hover:shadow-xl transition-all flex items-center gap-2">
      <span class="material-symbols-outlined text-lg">add</span>
      Add Expense
    </button>
  </div>
</div>

<!-- ── Budget Settings Modal ── -->
@if (showBudgetSettings$ | async) {
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-end sm:items-center
              justify-center p-0 sm:p-4"
       (click)="closeBudgetSettings()">
    <div class="w-full sm:max-w-md bg-white dark:bg-slate-900 sm:rounded-2xl rounded-t-2xl
                shadow-2xl border border-gray-200 dark:border-slate-700 overflow-hidden"
         (click)="$event.stopPropagation()">

      <!-- Header -->
      <div class="flex items-center justify-between px-5 py-4 border-b border-gray-200 dark:border-slate-700">
        <div>
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
            <span class="material-symbols-outlined text-accent">tune</span>
            Budget Settings
          </h2>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5 ml-8">
            for {{ monthLabel$ | async }}
          </p>
        </div>
        <button (click)="closeBudgetSettings()"
                class="w-8 h-8 rounded-lg flex items-center justify-center
                       hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors">
          <span class="material-symbols-outlined text-gray-500">close</span>
        </button>
      </div>

      <!-- Body -->
      <div class="p-5 space-y-5">

        <!-- Copy from previous month -->
        <button (click)="copyBudgetFromPrevMonth()"
                class="w-full px-4 py-2.5 rounded-xl text-sm font-medium border border-dashed
                       border-gray-300 dark:border-slate-600 text-gray-600 dark:text-gray-400
                       hover:border-accent hover:text-accent hover:bg-accent/5
                       transition-all flex items-center justify-center gap-2">
          <span class="material-symbols-outlined text-lg">content_copy</span>
          Copy budget from previous month
        </button>

        <!-- Monthly Budget -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">
            Monthly Budget (₹)
          </label>
          <input type="number"
                 [(ngModel)]="budgetForm.monthlyBudget"
                 placeholder="e.g. 50000"
                 min="0"
                 class="w-full px-4 py-2.5 rounded-xl border border-gray-200 dark:border-slate-700
                        bg-white dark:bg-slate-800 text-gray-900 dark:text-white text-sm
                        focus:outline-none focus:ring-2 focus:ring-accent/50 focus:border-accent
                        transition-all" />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            Set your spending limit for this month
          </p>
        </div>

        <!-- Alert Threshold -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">
            Alert Threshold: {{ budgetForm.alertThreshold }}%
          </label>
          <input type="range"
                 [(ngModel)]="budgetForm.alertThreshold"
                 min="50" max="100" step="5"
                 class="w-full h-2 bg-gray-200 dark:bg-slate-700 rounded-lg
                        appearance-none cursor-pointer accent-accent" />
          <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
            <span>50%</span>
            <span>100%</span>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            Get alerted when spending reaches this percentage of your budget
          </p>
        </div>
      </div>

      <!-- Footer -->
      <div class="flex items-center gap-3 px-5 py-4 border-t border-gray-200 dark:border-slate-700
                  bg-gray-50 dark:bg-slate-800/50">
        <button (click)="closeBudgetSettings()"
                class="flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-gray-700
                       dark:text-gray-300 border border-gray-200 dark:border-slate-700
                       hover:bg-gray-100 dark:hover:bg-slate-700 transition-all">
          Cancel
        </button>
        <button (click)="saveBudget()"
                [disabled]="savingBudget$ | async"
                class="flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-white btn-accent
                       transition-all disabled:opacity-50 disabled:cursor-not-allowed">
          @if (savingBudget$ | async) {
            Saving...
          } @else {
            Save for {{ monthLabel$ | async }}
          }
        </button>
      </div>

    </div>
  </div>
}