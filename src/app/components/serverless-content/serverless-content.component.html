<!-- Loading State -->
<div
  *ngIf="loading"
  class="flex items-center justify-center min-h-screen bg-white"
>
  <app-loader />
</div>

<!-- Error State -->
<div
  *ngIf="error && !loading"
  class="flex items-center justify-center min-h-screen bg-white"
>
  <div class="text-center">
    <div class="text-red-500 text-lg mb-4">{{ error }}</div>
    <button
      (click)="loadServerlessContent()"
      class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
    >
      Retry
    </button>
  </div>
</div>

<!-- Main Content -->
<div *ngIf="!loading && !error && contentData" class="bg-white min-h-screen">
  <!-- Header Section -->
  <div class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-4xl mx-auto px-6 py-3">
      <!-- Breadcrumb -->
      <div class="flex items-center gap-2 text-sm text-gray-600 mb-4">
        <button
          class="flex items-center gap-2 hover:bg-gray-100 px-3 py-1 rounded"
        >
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 16 16">
            <path
              d="m14.53 6.03-6 6a.75.75 0 0 1-1.004.052l-.056-.052-6-6 1.06-1.06L8 10.44l5.47-5.47z"
            />
          </svg>
          <span>Sumanth</span>
        </button>
        <span>/</span>
        <span class="font-semibold">Serverless Computing</span>
      </div>

      <!-- Action Buttons -->
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <!-- User Avatar -->
          <div
            class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center"
          >
            <img
              src="https://sumanthnagireddi2516.atlassian.net/wiki/aa-avatar/712020:ee561769-7c90-48f0-ad47-c93d292f605d"
              alt="Sumanth"
              class="w-6 h-6 rounded-full"
            />
          </div>
        </div>

        <div class="flex items-center gap-2">
          <!-- Edit Button -->
          <button
            (click)="editContent()"
            class="p-2 hover:bg-gray-100 rounded"
            title="Edit this content"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
          </button>

          <!-- Comments Button -->
          <button
            (click)="showComments()"
            class="p-2 hover:bg-gray-100 rounded"
            title="Show comments"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
              />
            </svg>
          </button>

          <!-- Star Button -->
          <button
            (click)="starContent()"
            class="p-2 hover:bg-gray-100 rounded"
            title="Star this content"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
              />
            </svg>
          </button>

          <!-- Watch Button -->
          <button
            (click)="watchContent()"
            class="p-2 hover:bg-gray-100 rounded"
            title="Watch this content"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
              />
            </svg>
          </button>

          <!-- Share Button -->
          <div class="flex items-center border rounded-md">
            <button
              (click)="shareContent()"
              class="px-3 py-2 flex items-center gap-2 hover:bg-gray-50 border-r"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                viewBox="0 0 16 16"
                stroke="currentColor"
              >
                <path
                  d="M8 1.5A2.5 2.5 0 0 0 5.5 4v3H12a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2V4a4 4 0 1 1 8 0h-1.5A2.5 2.5 0 0 0 8 1.5z"
                />
              </svg>
              Share
            </button>
            <button
              (click)="copyLink()"
              class="px-2 py-2 hover:bg-gray-50"
              title="Copy link"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                viewBox="0 0 16 16"
                stroke="currentColor"
              >
                <path
                  d="M8.22 2.22a3.932 3.932 0 1 1 5.56 5.56l-2.25 2.25-1.06-1.06 2.25-2.25a2.432 2.432 0 0 0-3.44-3.44L7.03 5.53 5.97 4.47z"
                />
              </svg>
            </button>
          </div>

          <!-- More Actions -->
          <button class="p-2 hover:bg-gray-100 rounded" title="More actions">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M0 8a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0m6.5 0a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0M13 8a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-4xl mx-auto px-6 py-8">
    <!-- Page Title -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900 mb-4 flex items-center group">
        {{
          contentData?.content?.introduction?.title || "Serverless Computing"
        }}
        <button
          (click)="copyLink()"
          class="ml-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-gray-100 rounded"
          title="Copy link"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
            />
          </svg>
        </button>
      </h1>

      <!-- Page Metadata -->
      <div class="flex items-center text-sm text-gray-600 mb-6">
        <div class="flex items-center gap-2">
          <img
            src="https://sumanthnagireddi2516.atlassian.net/wiki/aa-avatar/712020:ee561769-7c90-48f0-ad47-c93d292f605d"
            alt="Sumanth"
            class="w-8 h-8 rounded-full"
          />
          <div>
            <span
              >Owned by
              <a href="#" class="text-blue-600 hover:underline">{{
                contentData?.author || "Sumanth"
              }}</a></span
            >
            <button class="ml-1 p-1 hover:bg-gray-100 rounded">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M0 8a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0m6.5 0a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0M13 8a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0"
                />
              </svg>
            </button>
          </div>
        </div>
        <div class="ml-4">
          <span>{{ getFormattedDate() }}</span>
          <button
            class="ml-2 text-blue-600 hover:underline text-xs flex items-center gap-1"
          >
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M1 1h1.5v7.94l3.22-3.22a.75.75 0 0 1 1.06 0L8.5 7.44l3.94-3.94H10V2h4.25a.75.75 0 0 1 .75.75V7h-1.5V4.56L9.03 9.03a.75.75 0 0 1-1.06 0L6.25 7.31 2.5 11.06V13a.5.5 0 0 0 .5.5h12V15H3a2 2 0 0 1-2-2z"
              />
            </svg>
            See how many people viewed this
          </button>
        </div>
      </div>
    </div>

    <!-- Article Content -->
    <div class="prose prose-lg max-w-none">
      <p
        class="text-lg leading-relaxed"
        [innerHTML]="contentData?.content?.introduction?.description"
      ></p>

      <ul class="list-disc pl-6 space-y-2 mt-4">
        <li *ngFor="let point of contentData?.content?.introduction?.keyPoints">
          <ng-container *ngIf="typeof point === 'string'; else complexPoint">
            {{ point }}
          </ng-container>
          <ng-template #complexPoint>
            <strong>{{ point.title }}</strong>
            <ul class="list-disc pl-6 space-y-1 mt-2" *ngIf="point.details">
              <li *ngFor="let detail of point.details">{{ detail }}</li>
            </ul>
          </ng-template>
        </li>
      </ul>

      <h3 class="text-xl font-semibold mt-8 mb-4 flex items-center group">
        {{
          contentData?.content?.platforms?.title ||
            "Popular Serverless Platforms:"
        }}
        <button
          (click)="copyLink()"
          class="ml-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-gray-100 rounded"
          title="Copy link"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            viewBox="0 0 16 16"
            stroke="currentColor"
          >
            <path
              d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
            />
          </svg>
        </button>
      </h3>

      <!-- Serverless Platforms Table -->
      <div class="overflow-x-auto mt-6">
        <table class="min-w-full border border-gray-300">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="border border-gray-300 px-4 py-3 text-left font-medium text-gray-900"
              >
                Provider
              </th>
              <th
                class="border border-gray-300 px-4 py-3 text-left font-medium text-gray-900"
              >
                Serverless Service
              </th>
            </tr>
          </thead>
          <tbody class="bg-white">
            <tr *ngFor="let platform of contentData?.content?.platforms?.data">
              <td class="border border-gray-300 px-4 py-3">
                {{ platform.provider }}
              </td>
              <td class="border border-gray-300 px-4 py-3">
                {{ platform.service }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Labels Section -->
    <div class="mt-8 mb-6">
      <div class="flex items-center border rounded-md p-3 bg-gray-50">
        <svg
          class="w-6 h-6 text-gray-400 mr-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 6v6m0 0v6m0-6h6m-6 0H6"
          />
        </svg>
        <span class="text-gray-600">Add label</span>
      </div>
    </div>

    <!-- Reactions Section -->
    <div class="border-t pt-6 mt-8">
      <div class="flex items-start justify-between">
        <div class="flex flex-col">
          <!-- Reaction Buttons -->
          <div class="flex items-center gap-2 mb-2">
            <button
              (click)="addReaction('üëç')"
              class="flex items-center gap-2 px-3 py-2 border rounded hover:bg-gray-50"
            >
              <span class="text-sm">üëç</span>
            </button>
            <button
              (click)="addReaction('üëè')"
              class="flex items-center gap-2 px-3 py-2 border rounded hover:bg-gray-50"
            >
              <span class="text-sm">üëè</span>
            </button>
            <button
              (click)="addReaction('üéâ')"
              class="flex items-center gap-2 px-3 py-2 border rounded hover:bg-gray-50"
            >
              <span class="text-sm">üéâ</span>
            </button>
            <button
              (click)="toggleReactions()"
              class="flex items-center gap-2 px-3 py-2 border rounded hover:bg-gray-50"
              title="Add reaction"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                viewBox="0 0 16 16"
                stroke="currentColor"
              >
                <path
                  d="M1.5 8a6.5 6.5 0 1 0 13 0H16a8 8 0 1 1-8-8v1.5A6.5 6.5 0 0 0 1.5 8"
                />
              </svg>
            </button>
          </div>
          <p class="text-sm text-gray-600 ml-1">
            Be the first to add a reaction
          </p>
        </div>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="mt-8">
      <div class="flex items-start gap-3">
        <img
          src="https://secure.gravatar.com/avatar/627e7713e2d624e97d77193a8079e0e1?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FS-5.png"
          alt="Sumanth"
          class="w-8 h-8 rounded-full"
        />
        <div class="flex-1">
          <button
            (click)="addComment()"
            class="w-full text-left px-4 py-3 border border-gray-300 rounded-md bg-white hover:bg-gray-50 text-gray-600"
            *ngIf="!showCommentBox"
          >
            Write a comment‚Ä¶
          </button>

          <!-- Comment Box (when active) -->
          <div *ngIf="showCommentBox" class="border border-gray-300 rounded-md">
            <textarea
              class="w-full p-3 border-0 rounded-t-md resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
              rows="3"
              placeholder="Write a comment‚Ä¶"
            ></textarea>
            <div
              class="flex justify-end gap-2 p-3 border-t bg-gray-50 rounded-b-md"
            >
              <button
                (click)="showCommentBox = false"
                class="px-3 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded"
              >
                Cancel
              </button>
              <button
                class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700"
              >
                Comment
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating AI Button -->
  <div class="fixed bottom-4 right-6 z-10">
    <button
      class="bg-white border border-gray-300 rounded-full p-3 shadow-lg hover:shadow-xl transition-shadow"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        viewBox="0 0 16 16"
        stroke="currentColor"
      >
        <path
          d="M7.25 4V1h1.5v3zM5.47 6.53l-4-4 1.06-1.06 4 4zm4-1.06 4-4 1.06 1.06-4 4zM1 7.25h3v1.5H1zm11 0h3v1.5h-3z"
        />
      </svg>
    </button>
  </div>
</div>
